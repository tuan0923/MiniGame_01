//-----------------------------------------------------------------------------------------------
//
// 高速移動背景[bg_move.cpp]
// Author : SHUGO KURODA
//
//-----------------------------------------------------------------------------------------------

//-----------------------------------------------------------------------------------------------
// インクルードファイル
//-----------------------------------------------------------------------------------------------
#include "bg_move.h"
#include "manager.h"	// アプリケーション
#include "renderer.h"	// レンダリング

//-----------------------------------------------------------------------------------------------
// 定数宣言
//-----------------------------------------------------------------------------------------------

//-----------------------------------------------------------------------------------------------
// 静的メンバ変数
//-----------------------------------------------------------------------------------------------
// テクスチャのポインタ
LPDIRECT3DTEXTURE9 CBgMove::m_pTexture = {};

//-----------------------------------------------------------------------------------------------
// コンストラクタ
//-----------------------------------------------------------------------------------------------
CBgMove::CBgMove() :m_nCntAnim(0), m_nPatternAnim(0)
{
	SetType(EObject::OBJ_BG);
}

//-----------------------------------------------------------------------------------------------
// デストラクタ
//-----------------------------------------------------------------------------------------------
CBgMove::~CBgMove()
{

}

//-----------------------------------------------------------------------------------------------
// 生成
//-----------------------------------------------------------------------------------------------
CBgMove* CBgMove::Create()
{
	// ポインタクラスを宣言
	CBgMove* pBgMove = new CBgMove;

	if (pBgMove != nullptr)
	{// もしnullptrではなかったら

		// 初期化
		pBgMove->Init();

		// テクスチャの設定
		pBgMove->BindTexture(m_pTexture);
	}

	return pBgMove;
}

//-----------------------------------------------------------------------------------------------
// テクスチャの読み込み
//-----------------------------------------------------------------------------------------------
HRESULT CBgMove::Load()
{
	// デバイスの取得
	LPDIRECT3DDEVICE9 pDevice = CManager::GetManager()->GetRenderer()->GetDevice();

	// テクスチャの読み込み
	D3DXCreateTextureFromFile(pDevice,
		"data/TEXTURE/bgMove000.jpg",
		&m_pTexture);

	return S_OK;
}

//-----------------------------------------------------------------------------------------------
// テクスチャの削除
//-----------------------------------------------------------------------------------------------
void CBgMove::Unload()
{
	// テクスチャの破棄
	if (m_pTexture != nullptr)
	{
		m_pTexture->Release();
		m_pTexture = nullptr;
	}
}

//-----------------------------------------------------------------------------------------------
// 初期化
//-----------------------------------------------------------------------------------------------
HRESULT CBgMove::Init()
{
	// 位置の設定
	CObject2D::SetPosition(D3DXVECTOR3(CRenderer::SCREEN_WIDTH / 2, CRenderer::SCREEN_HEIGHT / 2, 0.0f));

	// サイズの設定
	CObject2D::SetSize(D3DXVECTOR2((float)CRenderer::SCREEN_WIDTH, (float)CRenderer::SCREEN_HEIGHT));

	//初期化
	CObject2D::Init();

	// テクスチャ座標設定
	CObject2D::SetAnimation(m_nPatternAnim, 0, 1.0f, 0.1f);

	return S_OK;
}

//-----------------------------------------------------------------------------------------------
// 終了
//-----------------------------------------------------------------------------------------------
void CBgMove::Uninit()
{
	CObject2D::Uninit();
}

//-----------------------------------------------------------------------------------------------
// 更新
//-----------------------------------------------------------------------------------------------
void CBgMove::Update()
{
	// カウントを増やす
	m_nCntAnim++;

	if (m_nCntAnim % 3 == 0)
	{
		// 今のアニメーションを1つ進める
		m_nPatternAnim++;
		m_nCntAnim = 0;
	}

	if (m_nPatternAnim >= 20)
	{// アニメーションが終わったら
		m_nPatternAnim = 0;
	}

	// テクスチャ座標の設定
	CObject2D::SetAnimation(m_nPatternAnim, 0, 10.0f, 1.0f);
}

//-----------------------------------------------------------------------------------------------
// 描画
//-----------------------------------------------------------------------------------------------
void CBgMove::Draw()
{
	CObject2D::Draw();
}